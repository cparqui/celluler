{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Celluler Configuration Schema",
  "description": "Configuration schema for Celluler cells",
  "type": "object",
  "required": ["version", "cell"],
  "properties": {
    "version": {
      "type": "integer",
      "enum": [1],
      "description": "Schema version",
      "default": 1
    },
    "cell": {
      "type": "object",
      "required": ["name", "id"],
      "properties": {
        "name": {
          "type": "string",
          "description": "Human-readable cell name",
          "default": "cell"
        },
        "id": {
          "type": "string",
          "description": "Unique cell identifier (maps to nodeID)",
          "default": "cell-${process.pid}"
        },
        "namespace": {
          "type": "string",
          "description": "Namespace for cell grouping",
          "default": "celluler"
        },
        "transporter": {
          "type": "object",
          "properties": {
            "type": {
              "type": "string",
              "enum": ["TCP", "nats", "redis", "mqtt"],
              "description": "Transporter type",
              "default": "TCP"
            },
            "options": {
              "type": "object",
              "description": "Transporter-specific options",
              "default": {
                "port": 0,
                "udpDiscovery": true,
                "udpReusePort": true,
                "udpPeriod": 30
              }
            }
          },
          "required": ["type"],
          "default": {
            "type": "TCP",
            "options": {
              "port": 0,
              "udpDiscovery": true,
              "udpReusePort": true,
              "udpPeriod": 30
            }
          }
        },
        "services": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "description": "List of services to enable",
              "default": ["nucleus"]
            },
            "config": {
              "type": "object",
              "description": "Service-specific configurations",
              "default": {
                "nucleus": {
                  "storage": "memory",
                  "encryption": true
                }
              }
            }
          },
          "required": ["enabled"],
          "default": {
            "enabled": ["nucleus"],
            "config": {
              "nucleus": {
                "storage": "memory",
                "encryption": true
              }
            }
          }
        },
        "logging": {
          "type": "object",
          "properties": {
            "level": {
              "type": ["string", "object"],
              "description": "Log level or module-specific log levels",
              "default": {
                "METRICS": "warn",
                "TRACING": "warn",
                "REGISTRY": "warn",
                "DISCOVERER": "warn",
                "TRANSIT": "warn",
                "**": "info"
              }
            },
            "output": {
              "type": "array",
              "items": {
                "type": "object",
                "required": ["type"],
                "properties": {
                  "type": {
                    "type": "string",
                    "enum": ["Console", "File", "Pino", "Bunyan", "Winston", "Debug", "Log4js", "Datadog"],
                    "description": "Logger type"
                  },
                  "options": {
                    "type": "object",
                    "properties": {
                      "level": {
                        "type": ["string", "object"],
                        "description": "Logger-specific level override"
                      },
                      "formatter": {
                        "type": "string",
                        "enum": ["full", "short", "simple", "json"],
                        "description": "Log formatter"
                      },
                      "colors": {
                        "type": "boolean",
                        "description": "Enable colors in console output",
                        "default": true
                      },
                      "moduleColors": {
                        "type": "boolean",
                        "description": "Enable module-specific colors",
                        "default": false
                      },
                      "autoPadding": {
                        "type": "boolean",
                        "description": "Auto-pad module names",
                        "default": false
                      },
                      "folder": {
                        "type": "string",
                        "description": "Log folder path for File logger"
                      },
                      "filename": {
                        "type": "string",
                        "description": "Log filename template for File logger"
                      },
                      "eol": {
                        "type": "string",
                        "description": "End of line character",
                        "default": "\n"
                      },
                      "interval": {
                        "type": "integer",
                        "description": "File appending interval in milliseconds",
                        "default": 1000
                      }
                    }
                  }
                }
              },
              "description": "List of logger configurations",
              "default": [
                {
                  "type": "Console",
                  "options": {
                    "formatter": "full",
                    "colors": true,
                    "moduleColors": false,
                    "autoPadding": false
                  }
                }
              ]
            }
          },
          "required": ["level", "output"],
          "default": {
            "level": {
              "METRICS": "warn",
              "TRACING": "warn",
              "REGISTRY": "warn",
              "DISCOVERER": "warn",
              "TRANSIT": "warn",
              "**": "info"
            },
            "output": [
              {
                "type": "Console",
                "options": {
                  "formatter": "full",
                  "colors": true,
                  "moduleColors": false,
                  "autoPadding": false
                }
              }
            ]
          }
        },
        "performance": {
          "type": "object",
          "properties": {
            "requestTimeout": {
              "type": "integer",
              "minimum": 0,
              "description": "Request timeout in milliseconds",
              "default": 5000
            },
            "maxCallLevel": {
              "type": "integer",
              "minimum": 0,
              "description": "Maximum call level for infinite loop protection",
              "default": 100
            },
            "heartbeatInterval": {
              "type": "integer",
              "minimum": 1,
              "description": "Heartbeat interval in seconds",
              "default": 5
            },
            "heartbeatTimeout": {
              "type": "integer",
              "minimum": 1,
              "description": "Heartbeat timeout in seconds",
              "default": 15
            }
          },
          "default": {
            "requestTimeout": 5000,
            "maxCallLevel": 100,
            "heartbeatInterval": 5,
            "heartbeatTimeout": 15
          }
        },
        "security": {
          "type": "object",
          "properties": {
            "tls": {
              "type": "boolean",
              "description": "Enable TLS",
              "default": false
            },
            "auth": {
              "type": "boolean",
              "description": "Enable authentication",
              "default": false
            },
            "encryption": {
              "type": "boolean",
              "description": "Enable encryption",
              "default": true
            }
          },
          "default": {
            "tls": false,
            "auth": false,
            "encryption": true
          }
        },
        "registry": {
          "type": "object",
          "properties": {
            "strategy": {
              "type": "string",
              "enum": ["RoundRobin", "Random"],
              "description": "Registry strategy",
              "default": "RoundRobin"
            },
            "preferLocal": {
              "type": "boolean",
              "description": "Prefer local services",
              "default": true
            }
          },
          "default": {
            "strategy": "RoundRobin",
            "preferLocal": true
          }
        },
        "circuitBreaker": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean",
              "description": "Enable circuit breaker",
              "default": true
            },
            "threshold": {
              "type": "number",
              "minimum": 0,
              "maximum": 1,
              "description": "Failure threshold",
              "default": 0.5
            },
            "windowTime": {
              "type": "integer",
              "minimum": 1,
              "description": "Window time in seconds",
              "default": 60
            },
            "minRequestCount": {
              "type": "integer",
              "minimum": 1,
              "description": "Minimum request count",
              "default": 20
            },
            "halfOpenTime": {
              "type": "integer",
              "minimum": 1,
              "description": "Half-open time in milliseconds",
              "default": 10000
            }
          },
          "default": {
            "enabled": true,
            "threshold": 0.5,
            "windowTime": 60,
            "minRequestCount": 20,
            "halfOpenTime": 10000
          }
        },
        "bulkhead": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean",
              "description": "Enable bulkhead",
              "default": true
            },
            "concurrency": {
              "type": "integer",
              "minimum": 1,
              "description": "Maximum concurrent requests",
              "default": 10
            },
            "maxQueueSize": {
              "type": "integer",
              "minimum": 1,
              "description": "Maximum queue size",
              "default": 100
            }
          },
          "default": {
            "enabled": true,
            "concurrency": 10,
            "maxQueueSize": 100
          }
        },
        "metrics": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean",
              "description": "Enable metrics",
              "default": true
            },
            "reporter": {
              "type": "array",
              "items": {
                "type": "string",
                "enum": ["Console", "Prometheus"]
              },
              "description": "Metrics reporters",
              "default": ["Console"]
            }
          },
          "default": {
            "enabled": true,
            "reporter": ["Console"]
          }
        },
        "tracing": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean",
              "description": "Enable tracing",
              "default": true
            },
            "exporter": {
              "type": "array",
              "items": {
                "type": "string",
                "enum": ["Console", "Jaeger"]
              },
              "description": "Tracing exporters",
              "default": ["Console"]
            }
          },
          "default": {
            "enabled": true,
            "exporter": ["Console"]
          }
        },
        "cacher": {
          "type": "object",
          "properties": {
            "type": {
              "type": "string",
              "enum": ["Memory", "Redis"],
              "description": "Cacher type",
              "default": "Memory"
            },
            "options": {
              "type": "object",
              "description": "Cacher-specific options",
              "default": {
                "max": 1000
              }
            }
          },
          "default": {
            "type": "Memory",
            "options": {
              "max": 1000
            }
          }
        },
        "serializer": {
          "type": "object",
          "properties": {
            "type": {
              "type": "string",
              "enum": ["JSON", "MsgPack"],
              "description": "Serializer type",
              "default": "JSON"
            },
            "options": {
              "type": "object",
              "description": "Serializer-specific options",
              "default": {}
            }
          },
          "default": {
            "type": "JSON",
            "options": {}
          }
        },
        "middlewares": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "List of middleware names to enable",
          "default": []
        },
        "metadata": {
          "type": "object",
          "description": "Custom key-value pairs",
          "default": {}
        }
      },
      "default": {
        "name": "cell",
        "id": "cell-${process.pid}",
        "namespace": "celluler",
        "transporter": {
          "type": "TCP",
          "options": {
            "port": 0,
            "udpDiscovery": true,
            "udpReusePort": true,
            "udpPeriod": 30
          }
        },
        "services": {
          "enabled": ["nucleus"],
          "config": {
            "nucleus": {
              "storage": "memory",
              "encryption": true
            }
          }
        },
        "logging": {
          "level": {
            "METRICS": "warn",
            "TRACING": "warn",
            "REGISTRY": "warn",
            "DISCOVERER": "warn",
            "TRANSIT": "warn",
            "**": "info"
          },
          "output": [
            {
              "type": "Console",
              "options": {
                "formatter": "full",
                "colors": true,
                "moduleColors": false,
                "autoPadding": false
              }
            }
          ]
        },
        "performance": {
          "requestTimeout": 5000,
          "maxCallLevel": 100,
          "heartbeatInterval": 5,
          "heartbeatTimeout": 15
        },
        "security": {
          "tls": false,
          "auth": false,
          "encryption": true
        },
        "registry": {
          "strategy": "RoundRobin",
          "preferLocal": true
        },
        "circuitBreaker": {
          "enabled": true,
          "threshold": 0.5,
          "windowTime": 60,
          "minRequestCount": 20,
          "halfOpenTime": 10000
        },
        "bulkhead": {
          "enabled": true,
          "concurrency": 10,
          "maxQueueSize": 100
        },
        "metrics": {
          "enabled": true,
          "reporter": ["Console"]
        },
        "tracing": {
          "enabled": true,
          "exporter": ["Console"]
        },
        "cacher": {
          "type": "Memory",
          "options": {
            "max": 1000
          }
        },
        "serializer": {
          "type": "JSON",
          "options": {}
        },
        "middlewares": [],
        "metadata": {}
      }
    }
  },
  "default": {
    "version": 1,
    "cell": {
      "name": "cell",
      "id": "cell-${process.pid}",
      "namespace": "celluler",
      "transporter": {
        "type": "TCP",
        "options": {
          "port": 0,
          "udpDiscovery": true,
          "udpReusePort": true,
          "udpPeriod": 30
        }
      },
      "services": {
        "enabled": ["nucleus"],
        "config": {
          "nucleus": {
            "storage": "memory",
            "encryption": true
          }
        }
      },
      "logging": {
        "level": {
          "METRICS": "warn",
          "TRACING": "warn",
          "REGISTRY": "warn",
          "DISCOVERER": "warn",
          "TRANSIT": "warn",
          "**": "info"
        },
        "output": [
          {
            "type": "Console",
            "options": {
              "formatter": "full",
              "colors": true,
              "moduleColors": false,
              "autoPadding": false
            }
          }
        ]
      },
      "performance": {
        "requestTimeout": 5000,
        "maxCallLevel": 100,
        "heartbeatInterval": 5,
        "heartbeatTimeout": 15
      },
      "security": {
        "tls": false,
        "auth": false,
        "encryption": true
      },
      "registry": {
        "strategy": "RoundRobin",
        "preferLocal": true
      },
      "circuitBreaker": {
        "enabled": true,
        "threshold": 0.5,
        "windowTime": 60,
        "minRequestCount": 20,
        "halfOpenTime": 10000
      },
      "bulkhead": {
        "enabled": true,
        "concurrency": 10,
        "maxQueueSize": 100
      },
      "metrics": {
        "enabled": true,
        "reporter": ["Console"]
      },
      "tracing": {
        "enabled": true,
        "exporter": ["Console"]
      },
      "cacher": {
        "type": "Memory",
        "options": {
          "max": 1000
        }
      },
      "serializer": {
        "type": "JSON",
        "options": {}
      },
      "middlewares": [],
      "metadata": {}
    }
  }
} 